<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png" />
    <script src="scripts/jquery-3.4.1.min.js"></script>
</head>

<body>
    <div>
        <div id="copyText"></div>
        <button id="test" style="color:white; background-color: blue;">Test</button>
    </div>
</body>

<script>
    var url = 'https://api.skinfo.se/';
    function isOS() {
        let chromeAgent = navigator.userAgent.indexOf("Chrome") > -1;
        let safariAgent = navigator.userAgent.indexOf("Safari") > -1;
        if (safariAgent && !chromeAgent)
            return true;

        return false;
    }

    function getLanguage() {
        return 'en-US';
    }

    function copyToClipboard(string) {
        let textarea;
        let result;

        try {
            textarea = document.createElement('textarea');
            textarea.setAttribute('readonly', true);
            textarea.setAttribute('contenteditable', true);
            textarea.style.position = 'fixed'; // prevent scroll from jumping to the bottom when focus is set.
            textarea.value = string;

            document.body.appendChild(textarea);
            if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {
                var el = $textarea.get(0);
                var editable = el.contentEditable;
                var readOnly = el.readOnly;
                el.contentEditable = 'true';
                el.readOnly = 'false';
                var range = document.createRange();
                range.selectNodeContents(el);
                var sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
                el.setSelectionRange(0, 999999);
                el.contentEditable = editable;
                el.readOnly = readOnly;
            } else {
                $textarea.select();
            }
            result = document.execCommand('copy');
            $textarea.blur();
        } catch (err) {
            console.error(err);
            result = null;
        } finally {
            document.body.removeChild(textarea);
        }

        // manual copy fallback using prompt
        if (!result) {
            const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
            const copyHotkey = isMac ? 'âŒ˜C' : 'CTRL+C';
            result = prompt(`Press ${copyHotkey}`, string); // eslint-disable-line no-alert
            if (!result) {
                return false;
            }
        }
        return true;
    }

    function createLink() {
        copyToClipboard('kalle');
        return;

        $.ajax({
            type: 'POST',
            headers: { 'apikey': '6h[-yENBfB' },
            url: url + 'website/createsharedlink?ingredients=' + 'aqua' + '&language=' + getLanguage(),
            dataType: 'html',
            async: false,
            complete: function (result) {
                var json = JSON.parse(result.responseText);
                // var textArea = document.createElement('textarea');
                //textArea.value = json.url;
                copyToClipboard(json.url);
                // var mainDiv = document.getElementById('copyText');
                // mainDiv.style.display = 'initial';
                // mainDiv.appendChild(textArea);

                // if (isOS()) {
                //     var range = document.createRange();
                //     range.selectNodeContents(textArea);
                //     selection = window.getSelection();
                //     selection.removeAllRanges();
                //     selection.addRange(range);
                //     textArea.setSelectionRange(0, 999999);
                // } else {
                //     var range = document.createRange();
                //     range.selectNode(textArea);
                //     window.getSelection().removeAllRanges();
                //     window.getSelection().addRange(range);
                // }

                // document.execCommand("copy");
                // window.getSelection().removeAllRanges();
                // mainDiv.removeChild(textArea);
                // mainDiv.style.display = 'none';



                console.log('ok');
            },
            error: function () {
                console.log('error');
            }
        });
    }

    document.getElementById('test').onclick = function () {
        createLink();
    }
</script>