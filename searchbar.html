<head>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/fonts.css">
    <script src="scripts/jquery-3.4.1.min.js"></script>
    <script src="scripts/skinfo.js"></script>

</head>

<body>
    <div class="searchbardiv">
        <div= class="searchbar">
            <div>
                <div style="width: 20px; height: 20px; float: left;">
                    <svg focusable="false" xmlns="http://www.w3.org/2000/svg" fill="#9aa0a6" viewBox="0 0 20 20">
                        <path
                            d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z">
                        </path>
                    </svg>
                </div>
                <input id="searchbox" type="text" placeholder="Search any ingredient..."
                    style="width: 90%; padding-left: 10px; float: left; text-decoration: none; border-bottom: none!important; box-shadow: none!important;">
                </input>
            </div>
            <div id="searchbar-suggestions" class="searchbar-suggestions" style="display: none;"></div>
    </div>
</body>

<script>
    var url = 'https://staging.skinfo.se/';
    $(document).ready(function () {
        
        $('#searchbox').on('keydown', function (e) {
            const key = e.key;
            if (key == 'Enter') {
                var text = $('#searchbox').val();
                if (text.length == 0) {
                    return;
                }

                if (text.includes(',')) {
                    window.location.href = 'search?id=' + text;
                }
                else {
                    var parent = document.getElementById('searchbar-suggestions');
                    window.location.href = 'search?id=' + parent.firstChild.innerText;
                }
            }
        });

        $('#searchbox').on('input', function (e) {
            var parent = document.getElementById('searchbar-suggestions');
            var text = $('#searchbox').val();

            if (text.length == 0) {
                parent.innerHTML = '';
                parent.style.display = 'none';
            }
            else if (text.includes(',')) {
                parent.innerHTML = '';
                parent.style.display = 'none';
            }
            else {
                $.ajax({
                    type: 'GET',
                    url: url + 'search/suggestion?query=' + text,
                    contentType: "application/json; charset=utf-8",
                    complete: function (result) {
                        if (result.responseJSON.length > 0) {
                            parent.style.display = 'inherit';
                            parent.innerHTML = '';
                            var text = $('#searchbox').val();
                            if (text.length == 0 || text.includes(',')) {
                                parent.innerHTML = '';
                                parent.style.display = 'none';
                                return;
                            }

                            result.responseJSON.forEach(element => {
                                var child = document.createElement('div');
                                child.innerText = element;
                                child.classList.add('searchbar-item');
                                child.onclick = function () {
                                    window.location.href = 'search?id=' + element;
                                }
                                parent.appendChild(child);
                            });
                        } else {
                            parent.style.display = 'none';
                        }
                    }
                });
            }
        });
    })
</script>